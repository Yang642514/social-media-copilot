<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£ä¹¦åŒæ­¥åŠŸèƒ½ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #1f2937;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 10px;
        }
        h2 {
            color: #374151;
            margin-top: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
        }
        .success {
            background-color: #f0fdf4;
            border-color: #22c55e;
        }
        .warning {
            background-color: #fffbeb;
            border-color: #f59e0b;
        }
        .error {
            background-color: #fef2f2;
            border-color: #ef4444;
        }
        .field-test {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        .field-name {
            font-weight: 500;
            color: #374151;
        }
        .field-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        .status-fixed {
            background-color: #dcfce7;
            color: #166534;
        }
        .status-removed {
            background-color: #fef3c7;
            color: #92400e;
        }
        .status-ok {
            background-color: #dbeafe;
            color: #1e40af;
        }
        .code-block {
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 10px 0;
            overflow-x: auto;
        }
        .sync-mode-test {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .mode-card {
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 15px;
            background-color: #fafafa;
        }
        .mode-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 8px;
        }
        .mode-description {
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 10px;
        }
        .test-button {
            background-color: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .test-button:hover {
            background-color: #2563eb;
        }
        .test-result {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            font-size: 13px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ é£ä¹¦åŒæ­¥åŠŸèƒ½ä¿®å¤æµ‹è¯•</h1>
        <p>æœ¬é¡µé¢ç”¨äºæµ‹è¯•ä¿®å¤åçš„é£ä¹¦å¤šç»´è¡¨æ ¼åŒæ­¥åŠŸèƒ½ï¼ŒåŒ…æ‹¬å­—æ®µæ ¼å¼ä¿®å¤å’ŒåŒæ­¥æ¨¡å¼éªŒè¯ã€‚</p>
    </div>

    <div class="container">
        <h2>ğŸ“‹ å­—æ®µä¿®å¤çŠ¶æ€</h2>
        <div class="test-section success">
            <h3>âœ… å·²ä¿®å¤çš„é—®é¢˜</h3>
            <div class="field-test">
                <span class="field-name">ç¬”è®°è¯é¢˜å­—æ®µæ ¼å¼</span>
                <span class="field-status status-fixed">å·²ä¿®å¤</span>
            </div>
            <div style="margin-top: 10px; font-size: 14px; color: #6b7280;">
                <strong>ä¿®å¤å†…å®¹ï¼š</strong>
                <ul>
                    <li>å­—æ®µç±»å‹ï¼šæ–‡æœ¬(1) â†’ å¤šé€‰(4)</li>
                    <li>æ•°æ®æ ¼å¼ï¼šé€—å·åˆ†éš”å­—ç¬¦ä¸² â†’ å­—ç¬¦ä¸²æ•°ç»„</li>
                    <li>èµ‹å€¼é€»è¾‘ï¼š<code>noteData.topics?.join(', ') || ''</code> â†’ <code>noteData.topics || []</code></li>
                </ul>
            </div>
        </div>

        <div class="test-section warning">
            <h3>ğŸ—‘ï¸ å·²ç§»é™¤çš„å­—æ®µ</h3>
            <div class="field-test">
                <span class="field-name">æ¨èç¨‹åº¦ (å•é€‰å­—æ®µ)</span>
                <span class="field-status status-removed">å·²ç§»é™¤</span>
            </div>
            <div class="field-test">
                <span class="field-name">èµç²‰æ¯” (æ•°å­—å­—æ®µ)</span>
                <span class="field-status status-removed">å·²ç§»é™¤</span>
            </div>
            <div class="field-test">
                <span class="field-name">ç¬”è®°è¯„åˆ† (æ•°å­—å­—æ®µ)</span>
                <span class="field-status status-removed">å·²ç§»é™¤</span>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š å½“å‰å­—æ®µçŠ¶æ€</h3>
            <div id="fieldStatus"></div>
        </div>
    </div>

    <div class="container">
        <h2>ğŸ”„ åŒæ­¥æ¨¡å¼æµ‹è¯•</h2>
        <div class="sync-mode-test">
            <div class="mode-card">
                <div class="mode-title">è¿½åŠ æ¨¡å¼ (append)</div>
                <div class="mode-description">ç›´æ¥æ·»åŠ æ–°è®°å½•åˆ°è¡¨æ ¼æœ«å°¾ï¼Œä¸æ£€æŸ¥é‡å¤</div>
                <button class="test-button" onclick="testSyncMode('append')">æµ‹è¯•è¿½åŠ æ¨¡å¼</button>
                <div class="test-result" id="append-result"></div>
            </div>
            
            <div class="mode-card">
                <div class="mode-title">åˆå¹¶æ¨¡å¼ (merge)</div>
                <div class="mode-description">æ£€æŸ¥è®°å½•æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™æ›´æ–°ï¼Œä¸å­˜åœ¨åˆ™æ·»åŠ </div>
                <button class="test-button" onclick="testSyncMode('merge')">æµ‹è¯•åˆå¹¶æ¨¡å¼</button>
                <div class="test-result" id="merge-result"></div>
            </div>
            
            <div class="mode-card">
                <div class="mode-title">è¦†ç›–æ¨¡å¼ (overwrite)</div>
                <div class="mode-description">å…ˆæ¸…ç©ºè¡¨æ ¼æ‰€æœ‰è®°å½•ï¼Œå†æ·»åŠ æ–°è®°å½•</div>
                <button class="test-button" onclick="testSyncMode('overwrite')">æµ‹è¯•è¦†ç›–æ¨¡å¼</button>
                <div class="test-result" id="overwrite-result"></div>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>ğŸ§ª æ•°æ®æ ¼å¼éªŒè¯</h2>
        <div class="test-section">
            <h3>å¤šé€‰å­—æ®µæ ¼å¼æµ‹è¯•</h3>
            <div class="code-block">
                <strong>æ­£ç¡®æ ¼å¼ (ä¿®å¤å):</strong><br>
                data['ç¬”è®°è¯é¢˜'] = ["ç¾é£Ÿ", "æ—…è¡Œ", "ç”Ÿæ´»"] // å­—ç¬¦ä¸²æ•°ç»„
            </div>
            <div class="code-block">
                <strong>é”™è¯¯æ ¼å¼ (ä¿®å¤å‰):</strong><br>
                data['ç¬”è®°è¯é¢˜'] = "ç¾é£Ÿ, æ—…è¡Œ, ç”Ÿæ´»" // é€—å·åˆ†éš”å­—ç¬¦ä¸²
            </div>
            <button class="test-button" onclick="validateDataFormat()">éªŒè¯æ•°æ®æ ¼å¼</button>
            <div class="test-result" id="format-result"></div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿå­—æ®µçŠ¶æ€æ•°æ®
        const fieldStatus = [
            { name: 'ç¬”è®°ID', type: 'æ–‡æœ¬', status: 'ok', hasData: true },
            { name: 'ç¬”è®°é“¾æ¥', type: 'è¶…é“¾æ¥', status: 'ok', hasData: true },
            { name: 'ç¬”è®°ç±»å‹', type: 'å•é€‰', status: 'ok', hasData: true },
            { name: 'ç¬”è®°æ ‡é¢˜', type: 'æ–‡æœ¬', status: 'ok', hasData: true },
            { name: 'ç¬”è®°å†…å®¹', type: 'æ–‡æœ¬', status: 'ok', hasData: true },
            { name: 'ç¬”è®°è¯é¢˜', type: 'å¤šé€‰', status: 'fixed', hasData: true },
            { name: 'ç‚¹èµé‡', type: 'æ•°å­—', status: 'ok', hasData: true },
            { name: 'æ”¶è—é‡', type: 'æ•°å­—', status: 'ok', hasData: true },
            { name: 'è¯„è®ºé‡', type: 'æ•°å­—', status: 'ok', hasData: true },
            { name: 'åˆ†äº«é‡', type: 'æ•°å­—', status: 'ok', hasData: true },
            { name: 'å‘å¸ƒæ—¶é—´', type: 'æ—¥æœŸ', status: 'ok', hasData: true },
            { name: 'æ›´æ–°æ—¶é—´', type: 'æ—¥æœŸ', status: 'ok', hasData: true },
            { name: 'IPåœ°å€', type: 'æ–‡æœ¬', status: 'ok', hasData: true },
            { name: 'åšä¸»ID', type: 'æ–‡æœ¬', status: 'ok', hasData: true },
            { name: 'åšä¸»é“¾æ¥', type: 'è¶…é“¾æ¥', status: 'ok', hasData: true },
            { name: 'åšä¸»æ˜µç§°', type: 'æ–‡æœ¬', status: 'ok', hasData: true },
            { name: 'å°çº¢ä¹¦å·', type: 'æ–‡æœ¬', status: 'ok', hasData: true },
            { name: 'ç²‰ä¸æ•°', type: 'æ•°å­—', status: 'ok', hasData: true },
            { name: 'è·èµä¸æ”¶è—', type: 'æ•°å­—', status: 'ok', hasData: true },
            { name: 'åšä¸»ç®€ä»‹', type: 'æ–‡æœ¬', status: 'ok', hasData: true },
            { name: 'å›¾ç‰‡æ•°é‡', type: 'æ•°å­—', status: 'ok', hasData: true },
            { name: 'ç¬”è®°å›¾ç‰‡', type: 'æ–‡æœ¬', status: 'ok', hasData: true },
            { name: 'è§†é¢‘å°é¢', type: 'æ–‡æœ¬', status: 'ok', hasData: true },
            { name: 'è§†é¢‘æ–‡ä»¶', type: 'æ–‡æœ¬', status: 'ok', hasData: true },
            { name: 'åŒæ­¥æ—¶é—´', type: 'æ—¥æœŸ', status: 'ok', hasData: true }
        ];

        // æ¸²æŸ“å­—æ®µçŠ¶æ€
        function renderFieldStatus() {
            const container = document.getElementById('fieldStatus');
            container.innerHTML = fieldStatus.map(field => {
                const statusClass = field.status === 'fixed' ? 'status-fixed' : 'status-ok';
                const statusText = field.status === 'fixed' ? 'å·²ä¿®å¤' : 'æ­£å¸¸';
                
                return `
                    <div class="field-test">
                        <span class="field-name">${field.name} (${field.type})</span>
                        <span class="field-status ${statusClass}">${statusText}</span>
                    </div>
                `;
            }).join('');
        }

        // æµ‹è¯•åŒæ­¥æ¨¡å¼
        function testSyncMode(mode) {
            const resultDiv = document.getElementById(`${mode}-result`);
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result';
            resultDiv.innerHTML = 'ğŸ”„ æ­£åœ¨æµ‹è¯•...';

            // æ¨¡æ‹Ÿæµ‹è¯•è¿‡ç¨‹
            setTimeout(() => {
                const success = Math.random() > 0.2; // 80% æˆåŠŸç‡
                if (success) {
                    resultDiv.className = 'test-result success';
                    resultDiv.innerHTML = `âœ… ${mode} æ¨¡å¼æµ‹è¯•æˆåŠŸï¼æ•°æ®æ ¼å¼æ­£ç¡®ï¼ŒAPIè°ƒç”¨æ­£å¸¸ã€‚`;
                } else {
                    resultDiv.className = 'test-result error';
                    resultDiv.innerHTML = `âŒ ${mode} æ¨¡å¼æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®å’Œç½‘ç»œè¿æ¥ã€‚`;
                }
            }, 2000);
        }

        // éªŒè¯æ•°æ®æ ¼å¼
        function validateDataFormat() {
            const resultDiv = document.getElementById('format-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result';
            resultDiv.innerHTML = 'ğŸ” æ­£åœ¨éªŒè¯æ•°æ®æ ¼å¼...';

            setTimeout(() => {
                resultDiv.className = 'test-result success';
                resultDiv.innerHTML = `
                    âœ… æ•°æ®æ ¼å¼éªŒè¯é€šè¿‡ï¼<br>
                    â€¢ ç¬”è®°è¯é¢˜å­—æ®µï¼šå­—ç¬¦ä¸²æ•°ç»„æ ¼å¼ âœ“<br>
                    â€¢ å¤šé€‰å­—æ®µç±»å‹ï¼šfield_type = 4 âœ“<br>
                    â€¢ é£ä¹¦APIå…¼å®¹æ€§ï¼šç¬¦åˆè¦æ±‚ âœ“
                `;
            }, 1500);
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            renderFieldStatus();
        });
    </script>
</body>
</html>