<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•é“¾æ¥å­—æ®µä¿®å¤</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .note-card {
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            background: #fff;
        }
        .note-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        .note-content {
            color: #666;
            margin-bottom: 12px;
        }
        .note-meta {
            display: flex;
            gap: 16px;
            font-size: 14px;
            color: #999;
        }
        .test-button {
            background: #ff2442;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 10px 5px;
        }
        .test-button:hover {
            background: #e01e3c;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-size: 14px;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <h1>ğŸ”— é“¾æ¥å­—æ®µä¿®å¤æµ‹è¯•</h1>
    
    <div class="status info">
        <strong>ä¿®å¤å†…å®¹ï¼š</strong>
        <ul>
            <li>å°†ç¬”è®°é“¾æ¥å­—æ®µç±»å‹ä»æ–‡æœ¬(1)æ”¹ä¸ºè¶…é“¾æ¥(15)</li>
            <li>å°†é“¾æ¥å€¼ä»å­—ç¬¦ä¸²æ”¹ä¸ºåŒ…å«textå’Œlinkå±æ€§çš„å¯¹è±¡</li>
            <li>æ·»åŠ äº†é“¾æ¥æ ¼å¼é”™è¯¯çš„è¯¦ç»†æç¤º</li>
        </ul>
    </div>

    <h2>ğŸ“ æµ‹è¯•ç¬”è®°æ ·æœ¬</h2>
    
    <!-- æ¨¡æ‹Ÿå°çº¢ä¹¦ç¬”è®°1 -->
    <div class="note-card" data-note-id="test1">
        <div class="note-title">ç§‹æ—¥ç©¿æ­åˆ†äº«ï½œæ¸©æŸ”å¥¶èŒ¶è‰²ç³»</div>
        <div class="note-content">ä»Šå¤©åˆ†äº«ä¸€å¥—è¶…æ¸©æŸ”çš„å¥¶èŒ¶è‰²ç³»ç©¿æ­ï½ç±³è‰²æ¯›è¡£é…å¡å…¶è‰²é˜”è…¿è£¤ï¼Œç®€çº¦åˆæœ‰è´¨æ„Ÿâœ¨</div>
        <div class="note-meta">
            <span class="note-author">@æ—¶å°šåšä¸»å°ç¾</span>
            <span class="note-time">2å°æ—¶å‰</span>
            <span class="note-likes">â¤ï¸ 1.2k</span>
            <span class="note-type">å›¾æ–‡</span>
        </div>
    </div>

    <!-- æ¨¡æ‹Ÿå°çº¢ä¹¦ç¬”è®°2 -->
    <div class="note-card" data-note-id="test2">
        <div class="note-title">è¶…ç®€å•çš„èœ‚èœœæŸ æª¬èŒ¶åšæ³•</div>
        <div class="note-content">å¤©æ°”è½¬å‡‰äº†ï¼Œæ¥ä¸€æ¯æš–æš–çš„èœ‚èœœæŸ æª¬èŒ¶ï½åªéœ€è¦3ä¸ªæ­¥éª¤å°±èƒ½åšå‡ºç¾å‘³çš„é¥®å“ğŸ‹</div>
        <div class="note-meta">
            <span class="note-author">@ç¾é£Ÿè¾¾äººå°å¨</span>
            <span class="note-time">5å°æ—¶å‰</span>
            <span class="note-likes">â¤ï¸ 856</span>
            <span class="note-type">å›¾æ–‡</span>
        </div>
    </div>

    <h2>ğŸ§ª æµ‹è¯•æ“ä½œ</h2>
    <button class="test-button" onclick="testDataExtraction()">æå–ç¬”è®°æ•°æ®</button>
    <button class="test-button" onclick="testFeishuSync()">æµ‹è¯•é£ä¹¦åŒæ­¥</button>
    <button class="test-button" onclick="clearResults()">æ¸…é™¤ç»“æœ</button>

    <div id="test-results"></div>

    <script>
        let extractedData = null;

        function showStatus(message, type = 'info') {
            const resultsDiv = document.getElementById('test-results');
            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = message;
            resultsDiv.appendChild(statusDiv);
        }

        function testDataExtraction() {
            showStatus('ğŸ” å¼€å§‹æå–ç¬”è®°æ•°æ®...', 'info');
            
            // æ¨¡æ‹Ÿæ•°æ®æå–
            const noteCards = document.querySelectorAll('.note-card');
            const notes = [];
            
            noteCards.forEach((card, index) => {
                const title = card.querySelector('.note-title').textContent;
                const content = card.querySelector('.note-content').textContent;
                const author = card.querySelector('.note-author').textContent.replace('@', '');
                const time = card.querySelector('.note-time').textContent;
                const likes = card.querySelector('.note-likes').textContent.replace('â¤ï¸ ', '');
                const type = card.querySelector('.note-type').textContent;
                
                const noteData = {
                    title: title,
                    content: content,
                    author: author,
                    publishTime: time,
                    likes: likes,
                    noteType: type,
                    url: `https://www.xiaohongshu.com/explore/test${index + 1}?xsec_token=test&xsec_source=pc_feed`
                };
                
                notes.push(noteData);
            });
            
            extractedData = notes;
            
            showStatus(`âœ… æˆåŠŸæå– ${notes.length} æ¡ç¬”è®°æ•°æ®`, 'success');
            showStatus(`ğŸ“‹ æ•°æ®é¢„è§ˆï¼š<pre>${JSON.stringify(notes[0], null, 2)}</pre>`, 'info');
        }

        function testFeishuSync() {
            if (!extractedData) {
                showStatus('âŒ è¯·å…ˆæå–ç¬”è®°æ•°æ®', 'error');
                return;
            }

            showStatus('ğŸš€ å¼€å§‹æµ‹è¯•é£ä¹¦åŒæ­¥...', 'info');
            
            // æ¨¡æ‹Ÿé“¾æ¥å­—æ®µæ ¼å¼
            const linkFieldData = {
                old_format: extractedData[0].url, // æ—§æ ¼å¼ï¼šå­—ç¬¦ä¸²
                new_format: {
                    text: extractedData[0].title,
                    link: extractedData[0].url
                }
            };
            
            showStatus(`ğŸ”— é“¾æ¥å­—æ®µæ ¼å¼å¯¹æ¯”ï¼š
                <br><strong>ä¿®å¤å‰ï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼‰ï¼š</strong>
                <pre>"${linkFieldData.old_format}"</pre>
                <br><strong>ä¿®å¤åï¼ˆå¯¹è±¡æ ¼å¼ï¼‰ï¼š</strong>
                <pre>${JSON.stringify(linkFieldData.new_format, null, 2)}</pre>`, 'info');
            
            // æ¨¡æ‹Ÿå‘é€åˆ°åå°è„šæœ¬
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                chrome.runtime.sendMessage({
                    action: 'syncToFeishu',
                    data: extractedData[0]
                }, (response) => {
                    if (response && response.success) {
                        showStatus('âœ… é£ä¹¦åŒæ­¥æˆåŠŸï¼é“¾æ¥å­—æ®µæ ¼å¼ä¿®å¤ç”Ÿæ•ˆ', 'success');
                    } else {
                        showStatus(`âŒ é£ä¹¦åŒæ­¥å¤±è´¥ï¼š${response?.error || 'æœªçŸ¥é”™è¯¯'}`, 'error');
                    }
                });
            } else {
                showStatus('âš ï¸ æµè§ˆå™¨æ‰©å±•ç¯å¢ƒæœªæ£€æµ‹åˆ°ï¼Œæ— æ³•æµ‹è¯•å®é™…åŒæ­¥åŠŸèƒ½', 'error');
                showStatus('ğŸ’¡ è¯·åœ¨å°çº¢ä¹¦é¡µé¢ä¸­ä½¿ç”¨æ‰©å±•åŠŸèƒ½è¿›è¡Œå®é™…æµ‹è¯•', 'info');
            }
        }

        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
            extractedData = null;
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ˜¾ç¤ºè¯´æ˜
        window.onload = function() {
            showStatus('ğŸ“– æµ‹è¯•è¯´æ˜ï¼šæ­¤é¡µé¢ç”¨äºéªŒè¯é“¾æ¥å­—æ®µæ ¼å¼ä¿®å¤ã€‚ç‚¹å‡»"æå–ç¬”è®°æ•°æ®"å¼€å§‹æµ‹è¯•ï¼Œç„¶åç‚¹å‡»"æµ‹è¯•é£ä¹¦åŒæ­¥"æŸ¥çœ‹ä¿®å¤æ•ˆæœã€‚', 'info');
        };
    </script>
</body>
</html>